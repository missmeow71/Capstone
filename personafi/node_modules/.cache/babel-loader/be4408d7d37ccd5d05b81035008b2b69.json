{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nimport Layout from '../components/Layout';\nimport CartItemList from '../components/CartItemList';\nimport CartSummary from '../components/CartSummary';\nimport { getCartItems, removeFromCart, checkoutCart, payForOrder } from '../lib/moltin';\n\nvar Cart =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Cart, _React$Component);\n\n  function Cart() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Cart);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Cart)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      items: [],\n      loading: true,\n      completed: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleCheckout\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(data) {\n        var cartId, token, email, _data$card, name, line_1, city, country, county, postcode, customer, address, _ref2, id;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return localStorage.getItem('mcart');\n\n              case 2:\n                cartId = _context.sent;\n                token = data.id, email = data.email, _data$card = data.card, name = _data$card.name, line_1 = _data$card.address_line1, city = _data$card.adress_city, country = _data$card.address_country, county = _data$card.address_state, postcode = _data$card.address_zip;\n                customer = {\n                  name: name,\n                  email: email\n                };\n                address = {\n                  first_name: name.split(' ')[0],\n                  last_name: name.split(' ')[1],\n                  line_1: line_1,\n                  city: city,\n                  county: county,\n                  country: country,\n                  postcode: postcode\n                };\n                _context.prev = 6;\n                _context.next = 9;\n                return checkoutCart(cartId, customer, address);\n\n              case 9:\n                _ref2 = _context.sent;\n                id = _ref2.data.id;\n                _context.next = 13;\n                return payForOrder(id, token, email);\n\n              case 13:\n                _this.setState({\n                  completed: true\n                });\n\n                _context.next = 19;\n                break;\n\n              case 16:\n                _context.prev = 16;\n                _context.t0 = _context[\"catch\"](6);\n                console.log(_context.t0);\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[6, 16]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleRemoveFromCart\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(itemId) {\n        var cartId, _ref4, data, meta;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                cartId = _this.state.cartId;\n                _context2.next = 3;\n                return removeFromCart(itemId, cartId);\n\n              case 3:\n                _ref4 = _context2.sent;\n                data = _ref4.data;\n                meta = _ref4.meta;\n\n                _this.setState({\n                  items: data,\n                  meta: meta\n                });\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  _createClass(Cart, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var cartId, _ref5, data, meta;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return localStorage.getItem('mcart');\n\n              case 2:\n                cartId = _context3.sent;\n                _context3.next = 5;\n                return getCartItems(cartId);\n\n              case 5:\n                _ref5 = _context3.sent;\n                data = _ref5.data;\n                meta = _ref5.meta;\n                this.setState({\n                  items: data,\n                  meta: meta,\n                  cartId: cartId,\n                  loading: false\n                });\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          meta = _this$state.meta,\n          rest = _objectWithoutProperties(_this$state, [\"meta\"]);\n\n      var loading = rest.loading;\n      return React.createElement(Layout, {\n        title: \"Cart\"\n      }, React.createElement(CartItemList, _extends({}, rest, {\n        removeFromCart: this._handleRemoveFromCart\n      })), !loading && !rest.completed && React.createElement(CartSummary, _extends({}, meta, {\n        handleCheckout: this._handleCheckout\n      })));\n    }\n  }]);\n\n  return Cart;\n}(React.Component);\n\nexport { Cart as default };","map":null,"metadata":{},"sourceType":"module"}